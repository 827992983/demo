

PDE 结构
|<------ 31~12------>|<------ 11~0 --------->| 比特
                     |b a 9 8 7 6 5 4 3 2 1 0| 
|--------------------|-|-|-|-|-|-|-|-|-|-|-|-| 占位
|<-------index------>| AVL |G|P|0|A|P|P|U|R|P| 属性
                             |S|   |C|W|/|/|
                                   |D|T|S|W|

PTE 结构
|<------ 31~12------>|<------ 11~0 --------->| 比特
                     |b a 9 8 7 6 5 4 3 2 1 0|
|--------------------|-|-|-|-|-|-|-|-|-|-|-|-| 占位
|<-------index------>| AVL |G|P|D|A|P|P|U|R|P| 属性
                             |A|   |C|W|/|/|
                             |T|   |D|T|S|W|

物理页属性
物理页的属性最后是以 PDE 为准，还是以 PTE 中的属性为准？
一个物理页索引号的确定是需要 PDE 和 PTE 共同决定的，那么物理页的属性自然也需要 PDE 和 PTE 两者的属性共同决定才行。
物理页属性 = PDE 中的属性 & PTE 中的属性
写成 C 语言的方式，就应该是：int physical_page_attribute = (0x00000fff & pde) & (0x00000fff & pte);

P 位
P 位在上一篇的读写空指针时提到过。这个位很简单，P=1 表示该页有效，P=0 则无效。

RW 位
RW = 1时，表示该页可写。
RW = 0时，表示该页只读。
如果你使用过常量区的变量，你可能会知道，什么样的页是只读的。比如：char *str = "Hello world!";

U/S
我们为了读写高 2G 内存的时候，非常辛苦，又是调用门又是中断门的，把程序的执行权限提高到了 0 环才能读取。高 2G 内存是被页机制所保护的，确切的说就是PDE和PTE的U/S属性位保护的，要想读取高 2G 内存，必须进行提权。
U/S 属性位，当该位为 1 时，表示用户位，即 U 位。该位为 0 时，表示系统位。通俗的讲，当该位为 1 时，物理页可以被0，1，2，3环的程序访问，当该位为 0 时，物理页只能被0，1， 2环的程序访问。

PS 位
PS，即 pagesize 的缩写，该属性只在 PDE 中才有，PTE对应的位置叫 PAT。
当 PS = 0 时，表明 PDE 指向一个 4KB 页表。这种线性地址对应的物理页，通常称之为小页面。
当 PS = 1 时，表明 PDE 指向一个 4MB 大小的普通物理页，而不是 PTT。这种页称为大页面。即：PDE直接就指向了具体的物理页，这时的物理页有4MB。
在 Windows 中，高 2G 有少量的线性地址，指向的是大页面。没错，大写页面是可以并存的。不信，去高 2G 线性地址去搜搜？

A 位
A 位，access 位，该位被置 1，说明对应的物理页被访问过。

D 位
D 位，dirty 位，该位置 1， 说明对应的物理页被写过。如果你以前学过操作系统的话，另外还学过页面置换算法的话，相信这个位你应该知道怎么用。

要解释PWT和PCD，先了解CPU缓存（CACHE）：
CPU缓存是位于CPU与物理内存之间的临时存储器，它的容量比内存小的多
但是交换速度却比内存要快得多。
CPU缓存可以做的很大，有几K、几十K、几百K 甚至上M的也有。
CPU缓存与TLB的区别：
TLB：线性地址  <----->  物理地址
CPU缓存：物理地址  <----->  内容

PWT（Page Write Through）
PWT置1，写Cache时也要将数据写入内存；置0，写Cache时由CPU控制寄存器决定是否写入内存。

PCD（Page Cache Disable）
置1，禁止写入cache，直接写入内存；置0，可以写入cache。

AVL：bit9-11，这三位CPU没有使用，留给操作系统用。主要用于换页。当某线性地址0x12345678暂时无用时，内存又紧张，操作系统就会把该线性地址的PTE的P置0，并修改PTE，如果后续应用程序再访问0x12345678，因为P=0，就会触发0xE号中断，在中断处理程序中，就会通过PTE当前值判断是在文件中（bit12-31会记录在文件中的哪个位置），还是确实缺页。这个过程是操作系统完成的，CPU不知道。
上面仅仅是一种情况，对于P=0，共有4中场景
前提：P=0,此时PTE的意义与原来不一样了，0xE号中断会有下面4种处理场景
情况1：位于页面文件
|<------31~12------>|b|a|98765|4321|0| 比特
|------文件偏移----|-|-|保护 |0000|-| 属性
bit:a -> 原位型
bit:b -> 转移位
情况2：要求一个0页面
|<------31~12------>|b|a|98765|4321|0| 比特
|-----------0-------|0|0|保护 |0000|0| 属性
情况3：页面正在转移
|<------31~12------>|b|a|98765|4 | 3|  2|1|0| 比特
|----页帧编号PFN----|1|0|保护 |Cd|Wt|U/S|W|0| 属性
情况4：未知原因，需检查VAD
|<-----------------31~1-------------->|0| 比特
|-----------------全为0--------------|0| 属性

实验：修改页属性，使3环可以访问高2G内存。
调用门中断门是提权了，3环提高到0环，才访问到高2G内存
修改页属性，没有提权，是修改了页属性才访问到高2G内存




